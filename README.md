# Домашнее задание к занятию "Репликация и масштабирование. Часть 2"- Протопопов Николай Андреевич


### Инструкция по выполнению домашнего задания

   1. Сделайте `fork` данного репозитория к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/git-hw или  https://github.com/имя-вашего-репозитория/7-1-ansible-hw).
   2. Выполните клонирование данного репозитория к себе на ПК с помощью команды `git clone`.
   3. Выполните домашнее задание и заполните у себя локально этот файл README.md:
      - впишите вверху название занятия и вашу фамилию и имя
      - в каждом задании добавьте решение в требуемом виде (текст/код/скриншоты/ссылка)
      - для корректного добавления скриншотов воспользуйтесь [инструкцией "Как вставить скриншот в шаблон с решением](https://github.com/netology-code/sys-pattern-homework/blob/main/screen-instruction.md)
      - при оформлении используйте возможности языка разметки md (коротко об этом можно посмотреть в [инструкции  по MarkDown](https://github.com/netology-code/sys-pattern-homework/blob/main/md-instruction.md))
   4. После завершения работы над домашним заданием сделайте коммит (`git commit -m "comment"`) и отправьте его на Github (`git push origin`);
   5. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
   6. Любые вопросы по выполнению заданий спрашивайте в чате учебной группы и/или в разделе “Вопросы по заданию” в личном кабинете.
   
Желаем успехов в выполнении домашнего задания!
   
### Дополнительные материалы, которые могут быть полезны для выполнения задания

1. [Руководство по оформлению Markdown файлов](https://gist.github.com/Jekins/2bf2d0638163f1294637#Code)


---
#Комманды для работы с GIT
1. git clone https://github.com/Nikolay-Protopopov/homework-zabbix.git
2. cd homework-zabbix 
3. mkdir screenshots
4. git add README.md screenshots/ 
5. git commit -m "Добавлены скриншоты и обновлен README"
6. git remote set-url origin "https://мой токен@github.com/Nikolay-Protopopov/homework-zabbix.git"
7. git push origin main

### Задание 1
Опишите основные преимущества использования масштабирования методами:

активный master-сервер и пассивный репликационный slave-сервер;
master-сервер и несколько slave-серверов;
Дайте ответ в свободной форме.
Активный master-сервер и пассивный репликационный slave-сервер

<pre>В данной схеме один сервер (master) является активным — он принимает все операции записи и чтения,
 а slave-сервер работает в пассивном режиме, получая изменения по репликации и не участвуя в обслуживании клиентов.

Основные преимущества:

Отказоустойчивость
Slave содержит актуальную копию данных и может быть быстро переведён в роль master при отказе основного сервера.

Простота архитектуры
Схема легко настраивается и администрируется, не требует сложной логики маршрутизации запросов.

Безопасность данных
Наличие реплики снижает риск потери данных при аппаратных сбоях, повреждении файловой системы или ошибках администратора.

Возможность резервного копирования без нагрузки на master
Бэкапы, проверки целостности и отчёты можно выполнять на slave-сервере.

Подготовка к масштабированию
Такая архитектура является базой для дальнейшего расширения (добавления активных slave-серверов).

Master-сервер и несколько slave-серверов

В этой схеме master-сервер выполняет операции записи, а несколько slave-серверов активно обслуживают запросы на чтение.

Основные преимущества:

Горизонтальное масштабирование чтения
Нагрузка на чтение распределяется между несколькими slave-серверами, что значительно увеличивает пропускную способность системы.

Повышение производительности
Master освобождается от большинства операций чтения и может сосредоточиться на записи и транзакциях.

Высокая доступность сервиса
При отказе одного slave-сервера система продолжает работать за счёт остальных.

Гибкое распределение нагрузки
Разные slave-серверы могут обслуживать разные типы запросов (отчёты, аналитика, пользовательские запросы).

Масштабируемость без остановки сервиса
Новые slave-серверы можно добавлять без простоя системы.

Поддержка геораспределения
Slave-серверы могут располагаться в разных дата-центрах, сокращая задержки для пользователей.</pre>

### Задание 2
Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц:

пользователи,
книги,
магазины (столбцы произвольно).
Опишите принципы построения системы и их разграничение или разбивку между базами данных.

Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.

 <pre>1. Исходные сущности (логическая модель)

#USERS#

user_id (PK)

name

email

region

created_at

#BOOKS#

book_id (PK)

title

author

category

price

#SHOPS#

shop_id (PK)

region

address

manager_id

2. Вертикальный шардинг (Vertical Sharding)
Цель

Разделить данные по функциональному назначению, снизить нагрузку, упростить масштабирование и безопасность.

Принцип

👉 Каждая группа таблиц — отдельная БД / кластер

Разделение
База данных	Таблицы	Назначение
DB_USERS	users	Аутентификация, профили
DB_CATALOG	books	Каталог книг
DB_SHOPS	shops	Магазины и логистика
Преимущества

Независимое масштабирование

Изоляция нагрузки

Разделение ответственности сервисов

Упрощение отказоустойчивости

3. Горизонтальный шардинг (Horizontal Sharding)
Цель

Масштабирование по объёму данных и количеству запросов.

3.1 Горизонтальный шардинг таблицы users
Ключ шардинга

user_id или region

Вариант A — по region
users_eu
users_us
users_asia

Вариант B — по hash(user_id)
Shard 1: user_id % 3 = 0
Shard 2: user_id % 3 = 1
Shard 3: user_id % 3 = 2

3.2 Горизонтальный шардинг таблицы books
Ключ

category или book_id

books_fiction
books_science
books_children


или

Shard 1: book_id 1–1M
Shard 2: book_id 1M–2M

3.3 Горизонтальный шардинг таблицы shops
Ключ

region

shops_eu
shops_us
shops_asia

4. Архитектура доступа (Routing Layer)

⚠️ Прямой доступ приложений к шардам запрещён

Используется:

Shard Router (middleware)

или Application-level routing

или Proxy (PgBouncer / Vitess / ProxySQL)

5. Режимы работы серверов
5.1 Для каждого шарда
MASTER (RW)
  ├── REPLICA 1 (RO)
  └── REPLICA 2 (RO)

Режимы
Тип	Назначение
Master	Запись + критичное чтение
Replica	Чтение
Async Replication	Основной режим
Sync (опционально)	Критичные данные
6. Итоговая блок-схема (ASCII)
                    ┌────────────────────┐
                    │    APPLICATION     │
                    └─────────┬──────────┘
                              │
                    ┌─────────▼──────────┐
                    │   SHARD ROUTER      │
                    │ (by region / hash)  │
                    └─────┬─────┬─────────┘
          ────────────────┼─────┼────────────────
                          │     │
        ┌─────────────────▼┐   ┌▼─────────────────┐
        │   DB_USERS        │   │   DB_CATALOG     │
        │ users_eu          │   │ books_fiction    │
        │ users_us          │   │ books_science    │
        │ users_asia        │   │ books_children   │
        └───────┬──────────┘   └───────┬──────────┘
                │                      │
        ┌───────▼─────────┐   ┌────────▼─────────┐
        │ DB_USERS_MASTER  │   │ DB_CATALOG_MASTER│
        │  RW              │   │ RW               │
        └───────┬─────────┘   └────────┬─────────┘
                │                      │
        ┌───────▼─────────┐   ┌────────▼─────────┐
        │ DB_USERS_REPLICA │   │ DB_CATALOG_REPLICA│
        │  RO              │   │ RO               │
        └─────────────────┘   └──────────────────┘


        ┌─────────────────────────────────────────┐
        │                DB_SHOPS                  │
        │ shops_eu / shops_us / shops_asia          │
        │ Master + Replicas                         │
        └─────────────────────────────────────────┘

7. Ключевые принципы системы

Вертикальный шардинг — разделение по бизнес-доменам

Горизонтальный шардинг — масштабирование по данным

Single Writer per Shard

Read Scalability через реплики

Routing слой обязателен

Нет JOIN между шардами

Eventual Consistency между БД

8. Когда применять
Сценарий	             Решение
Рост пользователей	 Горизонтальный users
Рост каталога	       Горизонтальный books
Геораспределение	    Шардинг по region
Разделение команд	    Вертикальный шардинг</pre>


